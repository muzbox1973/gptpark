<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post - GPT PARK</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
    <div class="container" style="max-width: 800px;">
        <header>
            <div class="logo">GPT PARK</div>
            <div style="display: flex; gap: 1rem; align-items: center;">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô Mode</button>
                <a href="/" class="back-link" style="margin-bottom: 0;">‚Üê Home</a>
            </div>
        </header>

        <article id="post-view">
            <div id="loader" style="text-align: center; padding: 4rem;">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 1rem;">Decyphering Neural Data...</p>
            </div>
            <div id="post-content-area" style="display: none;">
                <h1 id="post-title" class="post-title"></h1>
                <div id="post-tags" class="tags-container" style="margin-bottom: 1rem;"></div>
                <div id="post-date" style="color: var(--primary); margin-bottom: 3rem; font-size: 0.9rem;"></div>
                <div id="post-body" class="post-content"></div>
            </div>
        </article>

        <footer
            style="margin-top: 5rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-muted); font-size: 0.8rem;">
            &copy; 2026 GPT PARK. Collective Intelligence.
        </footer>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');

        // Theme Logic
        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'light') {
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
            }
            document.getElementById('theme-btn').innerText = theme === 'light' ? '‚òÄÔ∏è Light' : 'üåô Dark';
        }
        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            document.getElementById('theme-btn').innerText = isLight ? '‚òÄÔ∏è Light' : 'üåô Dark';
        }
        applyTheme();

        async function loadSinglePost() {
            if (!postId) {
                window.location.href = '/';
                return;
            }

            try {
                const res = await fetch(`/api/posts/${postId}`);
                if (!res.ok) throw new Error('Post not found');
                const post = await res.json();

                document.getElementById('post-title').innerText = post.title;
                document.getElementById('post-date').innerText = new Date(post.created_at).toLocaleDateString();
                document.getElementById('post-body').innerHTML = post.content;

                const tagsHtml = (post.tags || '').split(',').filter(t => t.trim()).map(t => `<span class="tag">${t.trim()}</span>`).join('');
                document.getElementById('post-tags').innerHTML = tagsHtml;

                document.getElementById('loader').style.display = 'none';
                document.getElementById('post-content-area').style.display = 'block';

                const sRes = await fetch('/api/settings');
                const settings = await sRes.json();
                document.querySelector('.logo').innerText = settings.title || 'GPT PARK Ïùò Ïù∏ÏÇ¨Ïù¥Ìä∏';
                document.title = `${post.title} - ${settings.title || 'GPT PARK Ïùò Ïù∏ÏÇ¨Ïù¥Ìä∏'}`;

            } catch (e) {
                document.getElementById('post-view').innerHTML = `<p style="text-align:center; padding: 4rem;">Error: ${e.message}</p>`;
            }
        }

        window.onscroll = function () {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progress-bar").style.width = scrolled + "%";
        };

        loadSinglePost();
    </script>
</body>

</html>